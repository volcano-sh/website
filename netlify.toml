# ============================================================
# NETLIFY BUILD CONFIGURATION - DOCUSAURUS MIGRATION
# ============================================================
# This configuration has been updated to preview the new Docusaurus site
# during the migration from Hugo. The Docusaurus site lives in the
# volcano-docs-docusaurus/ subdirectory while we validate the migration.
#
# Once migration is complete, we'll move Docusaurus to the root and
# remove Hugo entirely.
# ============================================================

[build]
  # Point to Docusaurus subdirectory
  base = "volcano-docs-docusaurus"
  
  # Install dependencies and build Docusaurus
  # Clear cache to prevent stale lockfile issues
  command = "rm -rf node_modules && npm ci && npm run build"
  
  # Publish the Docusaurus build output (relative to base directory)
  publish = "build"

[build.environment]
  # Use Node.js 20 for Docusaurus compatibility (matches CI)
  NODE_VERSION = "20"
  # Use verbose logging for debugging
  NPM_CONFIG_LOGLEVEL = "verbose"

# Production build settings
[context.production]
  base = "volcano-docs-docusaurus"
  command = "rm -rf node_modules && npm ci && npm run build"
  publish = "build"

[context.production.environment]
  NODE_VERSION = "20"
  NODE_ENV = "production"
  NPM_CONFIG_LOGLEVEL = "verbose"

# Deploy preview settings (for PRs)
[context.deploy-preview]
  base = "volcano-docs-docusaurus"
  command = "rm -rf node_modules && npm ci && npm run build"
  publish = "build"

[context.deploy-preview.environment]
  NODE_VERSION = "20"
  NPM_CONFIG_LOGLEVEL = "verbose"

# Branch deploy settings
[context.branch-deploy]
  base = "volcano-docs-docusaurus"
  command = "rm -rf node_modules && npm ci && npm run build"
  publish = "build"

[context.branch-deploy.environment]
  NODE_VERSION = "20"
  NPM_CONFIG_LOGLEVEL = "verbose"

# ============================================================
# LEGACY HUGO CONFIGURATION (preserved for reference)
# ============================================================
# The following Hugo configuration is preserved but inactive.
# Remove after migration is complete.
#
# [build]
# publish = "public"
# command = "HUGO_BASEURL=$URL hugo"
#
# [context.production.environment]
# HUGO_VERSION = "0.57.2"
# HUGO_ENV = "production"
# HUGO_ENABLEGITINFO = "true"
# ============================================================
